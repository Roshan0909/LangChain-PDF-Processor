{% extends 'students/base_student.html' %}

{% block title %}Quiz - Student{% endblock %}

{% block student_content %}
<div class="container">
    <h2 class="mb-4">Available Quizzes</h2>
    
    {% if quizzes %}
        <div class="row">
            {% for quiz in quizzes %}
                <div class="col-md-6 mb-4">
                    <div class="card shadow-lg h-100">
                        <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <h5 class="mb-0">{{ quiz.title }}</h5>
                            <small>{{ quiz.subject.name }}</small>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <p class="text-muted">{{ quiz.description }}</p>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-2">
                                    <span><i class="bi bi-list-ol"></i> Questions:</span>
                                    <strong>{{ quiz.questions.count }}</strong>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span><i class="bi bi-clock"></i> Duration:</span>
                                    <strong>{{ quiz.duration }} minutes</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span><i class="bi bi-file-pdf"></i> Based on:</span>
                                    <strong>{{ quiz.pdf_note.title }}</strong>
                                </div>
                            </div>
                            
                            {% if quiz.user_attempt %}
                                <div class="alert {% if quiz.percentage >= 35 %}alert-success{% else %}alert-danger{% endif %} mt-auto">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <div>
                                            <i class="bi bi-check-circle"></i> <strong>Completed!</strong>
                                        </div>
                                        <span class="badge {% if quiz.percentage >= 35 %}bg-success{% else %}bg-danger{% endif %} fs-6">
                                            {% if quiz.percentage >= 35 %}PASS{% else %}FAIL{% endif %}
                                        </span>
                                    </div>
                                    <div class="mb-2">
                                        Score: {{ quiz.user_attempt.score }}/{{ quiz.questions.count }} ({{ quiz.percentage }}%)
                                    </div>
                                    <div class="progress mb-2" style="height: 8px;">
                                        <div class="progress-bar" style="width: {{ quiz.percentage }}%; background-color: #667eea;"></div>
                                    </div>
                                    <a href="{% url 'quiz_report' quiz.user_attempt.id %}" class="btn btn-sm btn-outline-primary w-100">
                                        <i class="bi bi-file-text"></i> View Detailed Report
                                    </a>
                                </div>
                            {% else %}
                                <a href="javascript:void(0)" onclick="showStartQuizConfirmation('{% url 'take_quiz' quiz.id %}', `{{ quiz.title|escapejs }}`, {{ quiz.duration }}, {{ quiz.num_questions }})" class="btn mt-auto" style="background-color: #667eea; color: white;">
                                    <i class="bi bi-play-circle"></i> Start Quiz
                                </a>
                            {% endif %}
                        </div>
                        <div class="card-footer bg-transparent">
                            <small class="text-muted">Created on {{ quiz.created_at|date:"M d, Y" }}</small>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No quizzes available yet. Check back later!
        </div>
    {% endif %}
</div>

<style>
    /* Start Quiz Confirmation Modal */
    .start-quiz-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        z-index: 10000;
        animation: fadeIn 0.3s ease;
    }
    
    .start-quiz-modal {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        padding: 0;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 90%;
        z-index: 10001;
        animation: slideDown 0.4s ease;
        overflow: hidden;
    }
    
    .start-quiz-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 30px;
        text-align: center;
    }
    
    .start-quiz-icon {
        font-size: 70px;
        margin-bottom: 15px;
    }
    
    .start-quiz-title {
        font-size: 28px;
        font-weight: 700;
        color: white;
        margin: 0;
    }
    
    .start-quiz-body {
        padding: 35px;
    }
    
    .quiz-info {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
    }
    
    .quiz-info-item {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        font-size: 16px;
        color: #4a5568;
    }
    
    .quiz-info-item:last-child {
        margin-bottom: 0;
    }
    
    .quiz-info-item i {
        font-size: 20px;
        color: #667eea;
        margin-right: 12px;
        width: 25px;
    }
    
    .start-quiz-warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 25px;
        font-size: 14px;
        color: #856404;
    }
    
    .start-quiz-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }
    
    .start-quiz-btn {
        padding: 14px 35px;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-cancel-quiz {
        background: #6c757d;
        color: white;
    }
    
    .btn-cancel-quiz:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(108, 117, 125, 0.3);
    }
    
    .btn-start-quiz {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .btn-start-quiz:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translate(-50%, -60%);
        }
        to {
            opacity: 1;
            transform: translate(-50%, -50%);
        }
    }
</style>

<script>
    function showStartQuizConfirmation(quizUrl, quizTitle, duration, numQuestions) {
        const overlay = document.createElement('div');
        overlay.className = 'start-quiz-overlay';
        overlay.style.display = 'block';
        
        const modal = document.createElement('div');
        modal.className = 'start-quiz-modal';
        modal.innerHTML = `
            <div class="start-quiz-header">
                <div class="start-quiz-icon">üéØ</div>
                <h3 class="start-quiz-title">Ready to Start?</h3>
            </div>
            <div class="start-quiz-body">
                <div class="quiz-info">
                    <div class="quiz-info-item">
                        <i class="bi bi-file-text"></i>
                        <strong>${quizTitle}</strong>
                    </div>
                    <div class="quiz-info-item">
                        <i class="bi bi-clock"></i>
                        <span>Duration: <strong>${duration} minutes</strong></span>
                    </div>
                    <div class="quiz-info-item">
                        <i class="bi bi-list-ol"></i>
                        <span>Questions: <strong>${numQuestions}</strong></span>
                    </div>
                </div>
                
                <div class="start-quiz-warning">
                    <strong>‚ö†Ô∏è Important:</strong> Once you start, the timer will begin immediately. Make sure you have enough time to complete the quiz without interruptions.
                </div>
                
                <div class="start-quiz-buttons">
                    <button class="start-quiz-btn btn-cancel-quiz" onclick="closeStartQuizModal()">
                        <i class="bi bi-x-circle"></i> Cancel
                    </button>
                    <button class="start-quiz-btn btn-start-quiz" onclick="confirmStartQuiz('${quizUrl}')">
                        <i class="bi bi-play-circle-fill"></i> Start Quiz
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(overlay);
        document.body.appendChild(modal);
        
        overlay.addEventListener('click', closeStartQuizModal);
    }
    
    function closeStartQuizModal() {
        const overlay = document.querySelector('.start-quiz-overlay');
        const modal = document.querySelector('.start-quiz-modal');
        if (overlay) overlay.remove();
        if (modal) modal.remove();
    }
    
    function confirmStartQuiz(url) {
        closeStartQuizModal();
        window.location.href = url;
    }
</script>

{% endblock %}
