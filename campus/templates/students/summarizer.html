{% extends 'students/base_student.html' %}

{% block title %}Summarizer - Student{% endblock %}

{% block student_content %}
<div class="container-compact">
    <!-- Page Header -->
    <div class="page-header-summary">
        <div class="header-content">
            <h1><i class="bi bi-file-text"></i> Smart Summarizer</h1>
            <p>Transform text, PDFs, and documents into concise summaries instantly</p>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="summarizer-grid">
        <!-- Input Section -->
        <div class="summary-card">
            <div class="card-header-summary">
                <h3><i class="bi bi-input-cursor"></i> Input</h3>
            </div>
            <div class="card-body-summary">
                <form id="summarizerForm" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Tab Navigation -->
                    <div class="tab-navigation">
                        <button class="tab-btn active" data-tab="text-input" type="button">
                            <i class="bi bi-textarea-t"></i> Text
                        </button>
                        <button class="tab-btn" data-tab="file-input" type="button">
                            <i class="bi bi-file-earmark-arrow-up"></i> File
                        </button>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="tab-content-summary">
                        <!-- Text Input Tab -->
                        <div class="tab-pane active" id="text-input">
                            <div class="form-group-compact">
                                <label>Paste your text here</label>
                                <textarea class="input-compact" id="textInput" name="text" rows="5" placeholder="Enter text to summarize... (min 50 characters)"></textarea>
                                <small><span id="charCount">0</span> / 50 characters</small>
                            </div>
                        </div>
                        
                        <!-- File Upload Tab -->
                        <div class="tab-pane" id="file-input">
                            <div class="form-group-compact">
                                <label>Upload File</label>
                                <div id="dropZoneFile" class="drop-zone-compact">
                                    <i class="bi bi-cloud-arrow-up"></i>
                                    <p>Drag & drop or click to browse</p>
                                    <small>PDF, DOC, DOCX, PPT, PPTX</small>
                                </div>
                                <input class="d-none" type="file" id="fileInput" name="file" accept=".pdf,.doc,.docx,.ppt,.pptx">
                                <div id="fileInfo" class="file-info-compact" style="display: none;">
                                    <i class="bi bi-check-circle"></i> <span id="fileName"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary Type Selection -->
                    <div class="form-group-compact">
                        <label>Summary Style</label>
                        <div class="summary-type-buttons">
                            <input type="radio" class="radio-check" name="summary_type" id="concise" value="concise" checked>
                            <label class="radio-label" for="concise">
                                <i class="bi bi-lightning"></i> Concise
                            </label>
                            
                            <input type="radio" class="radio-check" name="summary_type" id="detailed" value="detailed">
                            <label class="radio-label" for="detailed">
                                <i class="bi bi-list-ul"></i> Detailed
                            </label>
                            
                            <input type="radio" class="radio-check" name="summary_type" id="bullets" value="bullets">
                            <label class="radio-label" for="bullets">
                                <i class="bi bi-card-list"></i> Bullets
                            </label>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn-generate">
                        <i class="bi bi-stars"></i> Generate Summary
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Output Section -->
        <div class="summary-card">
            <div class="card-header-summary">
                <div class="header-flex">
                    <h3><i class="bi bi-file-earmark-text"></i> Summary</h3>
                    <button id="copyBtn" class="btn-copy" onclick="copySummary()" style="display: none;">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            </div>
            <div class="card-body-summary">
                <div id="summaryOutput" class="summary-output-compact">
                    <div class="empty-state-summary">
                        <i class="bi bi-file-text"></i>
                        <p>Your summary will appear here</p>
                        <small>Enter text or upload a file</small>
                    </div>
                </div>
                
                <!-- Loading Indicator -->
                <div id="loadingIndicator" class="loading-state-summary" style="display: none;">
                    <div class="spinner-dots-compact">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <p>Generating summary...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Info Cards -->
    <div class="info-cards-grid">
        <div class="info-card">
            <i class="bi bi-lightning-charge"></i>
            <h6>Fast Processing</h6>
            <small>Get results in seconds</small>
        </div>
        <div class="info-card">
            <i class="bi bi-file-earmark-pdf"></i>
            <h6>Multiple Formats</h6>
            <small>Text, PDF, Word, PowerPoint</small>
        </div>
        <div class="info-card">
            <i class="bi bi-brain"></i>
            <h6>AI-Powered</h6>
            <small>Smart summarization</small>
        </div>
    </div>
</div>

<style>
                        </div>
                        <p class="mt-3">Generating summary...</p>
                        <small class="text-muted">This may take a few moments</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Info Cards -->
    <div class="row mt-4">
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100" style="border-left: 4px solid #667eea;">
                <div class="card-body">
                    <i class="bi bi-lightning-charge" style="font-size: 2rem; color: #667eea;"></i>
                    <h6 class="mt-2">Quick & Easy</h6>
                    <small class="text-muted">Get summaries in seconds</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100" style="border-left: 4px solid #764ba2;">
                <div class="card-body">
                    <i class="bi bi-file-earmark-pdf" style="font-size: 2rem; color: #764ba2;"></i>
                    <h6 class="mt-2">Multiple Formats</h6>
                    <small class="text-muted">Text, PDF, Word documents</small>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card text-center h-100" style="border-left: 4px solid #667eea;">
                <div class="card-body">
                    <i class="bi bi-brain" style="font-size: 2rem; color: #667eea;"></i>
                    <h6 class="mt-2">AI-Powered</h6>
                    <small class="text-muted">Smart summarization with Gemini</small>
                </div>
            </div>
        </div>
    </div>
</div>

    /* Container & Layout */
    .container-compact {
        max-width: 1000px;
        margin: 0 auto;
        padding: 1rem;
    }
    
    /* Page Header */
    .page-header-summary {
        background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
        border-top: 4px solid #06B6D4;
        color: white;
        padding: 1rem 1.25rem;
        border-radius: 0.75rem;
        margin-bottom: 1.25rem;
        box-shadow: 0 4px 16px rgba(6, 182, 212, 0.15);
    }
    
    .header-content h1 {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: 0.3rem;
        display: flex;
        align-items: center;
        gap: 0.6rem;
        letter-spacing: -0.5px;
    }
    
    .header-content h1 i {
        color: #06B6D4;
        font-size: 1.6rem;
    }
    
    .header-content p {
        color: #cbd5e1;
        font-size: 0.95rem;
        margin: 0;
        font-weight: 500;
    }
    
    /* Grid Layout */
    .summarizer-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    @media (max-width: 1024px) {
        .summarizer-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Summary Cards */
    .summary-card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border-top: 3px solid #06B6D4;
        overflow: hidden;
    }
    
    .card-header-summary {
        background: linear-gradient(135deg, #1E293B 0%, #0F172A 100%);
        padding: 0.85rem 1rem;
        color: white;
        border-bottom: 2px solid rgba(6, 182, 212, 0.2);
    }
    
    .card-header-summary h3 {
        font-size: 1rem;
        font-weight: 800;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        letter-spacing: -0.3px;
    }
    
    .card-header-summary h3 i {
        color: #06B6D4;
        font-size: 1.1rem;
    }
    
    .header-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .card-body-summary {
        padding: 1rem;
    }
    
    /* Tab Navigation */
    .tab-navigation {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 0.85rem;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .tab-btn {
        background: none;
        border: none;
        padding: 0.75rem 1.25rem;
        font-weight: 700;
        font-size: 0.9rem;
        color: #64748B;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        position: relative;
        border-bottom: 3px solid transparent;
    }
    
    .tab-btn:hover {
        color: #06B6D4;
    }
    
    .tab-btn.active {
        color: #06B6D4;
        border-bottom-color: #06B6D4;
    }
    
    .tab-btn i {
        font-size: 1rem;
    }
    
    /* Form Groups */
    .form-group-compact {
        margin-bottom: 0.85rem;
    }
    
    .form-group-compact label {
        font-weight: 700;
        color: #1E293B;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .form-group-compact small {
        color: #64748B;
        font-weight: 600;
        font-size: 0.8rem;
    }
    
    /* Input Styles */
    .input-compact {
        width: 100%;
        padding: 0.7rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        font-family: inherit;
        transition: all 0.3s;
        resize: vertical;
        min-height: 110px;
    }
    
    .input-compact:focus {
        outline: none;
        border-color: #06B6D4;
        box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
    }
    
    /* Drop Zone */
    .drop-zone-compact {
        border: 2px dashed #cbd5e1;
        border-radius: 0.5rem;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.3s;
        background: #f8fafc;
        cursor: pointer;
    }
    
    .drop-zone-compact:hover {
        border-color: #06B6D4;
        background: white;
    }
    
    .drop-zone-compact.drag-over {
        border-color: #06B6D4;
        background: linear-gradient(135deg, #E0F2FE 0%, #CFFAFE 100%);
        border-style: solid;
    }
    
    .drop-zone-compact i {
        font-size: 2rem;
        color: #06B6D4;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .drop-zone-compact p {
        font-weight: 700;
        color: #1E293B;
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
    }
    
    .drop-zone-compact small {
        color: #64748B;
        font-size: 0.8rem;
    }
    
    /* File Info */
    .file-info-compact {
        margin-top: 0.75rem;
        padding: 0.6rem 0.85rem;
        background: linear-gradient(135deg, #E0F2FE 0%, #CFFAFE 100%);
        border-left: 3px solid #06B6D4;
        border-radius: 0.4rem;
        color: #0F766E;
        font-weight: 600;
        font-size: 0.85rem;
    }
    
    /* Summary Type Buttons */
    .summary-type-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    
    .radio-check {
        display: none;
    }
    
    .radio-label {
        flex: 1;
        min-width: 90px;
        padding: 0.6rem 0.8rem;
        border: 2px solid #e2e8f0;
        border-radius: 0.5rem;
        text-align: center;
        font-weight: 700;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s;
        color: #64748B;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.4rem;
    }
    
    .radio-label:hover {
        border-color: #06B6D4;
        color: #06B6D4;
    }
    
    .radio-check:checked + .radio-label {
        background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
        color: white;
        border-color: #06B6D4;
    }
    
    /* Generate Button */
    .btn-generate {
        width: 100%;
        padding: 0.7rem 1.25rem;
        background: linear-gradient(135deg, #06B6D4 0%, #0891B2 100%);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(6, 182, 212, 0.25);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .btn-generate:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 16px rgba(6, 182, 212, 0.35);
    }
    
    /* Summary Output */
    .summary-output-compact {
        min-height: 300px;
        max-height: 450px;
        overflow-y: auto;
        padding: 1.25rem;
        background: #f8fafc;
        border-radius: 0.5rem;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 0.9rem;
        line-height: 1.6;
        color: #1E293B;
    }
    
    .summary-output-compact::-webkit-scrollbar {
        width: 6px;
    }
    
    .summary-output-compact::-webkit-scrollbar-track {
        background: #e2e8f0;
        border-radius: 3px;
    }
    
    .summary-output-compact::-webkit-scrollbar-thumb {
        background: #06B6D4;
        border-radius: 3px;
    }
    
    .summary-output-compact::-webkit-scrollbar-thumb:hover {
        background: #0891B2;
    }
    
    /* Empty State */
    .empty-state-summary {
        text-align: center;
        padding: 2rem 1rem;
        color: #64748B;
    }
    
    .empty-state-summary i {
        font-size: 2.5rem;
        color: #06B6D4;
        opacity: 0.6;
        margin-bottom: 0.75rem;
        display: block;
    }
    
    .empty-state-summary p {
        font-weight: 600;
        margin-bottom: 0.3rem;
        color: #1E293B;
    }
    
    .empty-state-summary small {
        font-size: 0.8rem;
    }
    
    /* Loading State */
    .loading-state-summary {
        text-align: center;
        padding: 2rem 1rem;
    }
    
    .spinner-dots-compact {
        display: flex;
        gap: 0.4rem;
        justify-content: center;
        margin-bottom: 1rem;
    }
    
    .spinner-dots-compact span {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #06B6D4;
        animation: pulse-dot 1.4s infinite;
    }
    
    .spinner-dots-compact span:nth-child(2) {
        animation-delay: 0.2s;
    }
    
    .spinner-dots-compact span:nth-child(3) {
        animation-delay: 0.4s;
    }
    
    @keyframes pulse-dot {
        0%, 80%, 100% {
            opacity: 0.4;
            transform: translateY(0);
        }
        40% {
            opacity: 1;
            transform: translateY(-8px);
        }
    }
    
    .loading-state-summary p {
        color: #1E293B;
        font-weight: 700;
        margin-bottom: 0.3rem;
    }
    
    .loading-state-summary small {
        color: #64748B;
        font-size: 0.85rem;
    }
    
    /* Helper Classes */
    .d-none {
        display: none !important;
    }
    
    /* Copy Button */
    .btn-copy {
        background: rgba(6, 182, 212, 0.15);
        border: 1px solid rgba(6, 182, 212, 0.3);
        color: #06B6D4;
        padding: 0.5rem 0.75rem;
        border-radius: 0.4rem;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 0.9rem;
    }
    
    .btn-copy:hover {
        background: rgba(6, 182, 212, 0.25);
        border-color: #06B6D4;
    }
    
    /* Info Cards Grid */
    .info-cards-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
    }
    
    @media (max-width: 768px) {
        .info-cards-grid {
            grid-template-columns: 1fr;
        }
    }
    
    /* Info Card */
    .info-card {
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        padding: 1.25rem;
        text-align: center;
        transition: all 0.3s;
        border-left: 4px solid #06B6D4;
    }
    
    .info-card:hover {
        box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
        border-left-color: #0891B2;
    }
    
    .info-card i {
        font-size: 1.8rem;
        color: #06B6D4;
        margin-bottom: 0.75rem;
        display: block;
    }
    
    .info-card h6 {
        font-size: 0.95rem;
        font-weight: 800;
        color: #1E293B;
        margin-bottom: 0.3rem;
    }
    
    .info-card small {
        color: #64748B;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    /* Tab Content */
    .tab-content-summary {
        margin-top: 0.65rem;
    }
    
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: block;
    }
</style>

<script>
    const textInput = document.getElementById('textInput');
    const charCount = document.getElementById('charCount');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const summarizerForm = document.getElementById('summarizerForm');
    const summaryOutput = document.getElementById('summaryOutput');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const copyBtn = document.getElementById('copyBtn');
    const dropZoneFile = document.getElementById('dropZoneFile');
    const tabButtons = document.querySelectorAll('.tab-btn');
    
    // Tab navigation
    tabButtons.forEach(button => {
        button.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            this.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Drag and drop handlers
    dropZoneFile.addEventListener('click', function() {
        fileInput.click();
    });
    
    dropZoneFile.addEventListener('dragover', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.add('drag-over');
    });
    
    dropZoneFile.addEventListener('dragleave', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.remove('drag-over');
    });
    
    dropZoneFile.addEventListener('drop', function(e) {
        e.preventDefault();
        e.stopPropagation();
        this.classList.remove('drag-over');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(files[0]);
            fileInput.files = dataTransfer.files;
            fileInput.dispatchEvent(new Event('change'));
        }
    });
    
    // Character counter
    textInput.addEventListener('input', function() {
        charCount.textContent = this.value.length;
        if (this.value.trim().length > 0) {
            fileInput.value = '';
            fileInfo.style.display = 'none';
        }
    });
    
    // File input handler
    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            fileName.textContent = this.files[0].name;
            fileInfo.style.display = 'block';
            textInput.value = '';
            charCount.textContent = '0';
        } else {
            fileInfo.style.display = 'none';
        }
    });
    
    // Form submission
    summarizerForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
        formData.append('summary_type', document.querySelector('input[name="summary_type"]:checked').value);
        
        // Validate input
        const text = textInput.value.trim();
        const file = fileInput.files[0];
        
        if (!text && !file) {
            alert('Please enter text or upload a file');
            return;
        }
        
        // Add text or file to formData
        if (text) {
            formData.append('text', text);
        } else if (file) {
            formData.append('file', file);
        }
        
        // Show loading
        summaryOutput.innerHTML = '';
        summaryOutput.style.display = 'none';
        loadingIndicator.style.display = 'block';
        copyBtn.style.display = 'none';
        
        try {
            const response = await fetch('{% url "generate_summary" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                },
                body: formData
            });
            
            const data = await response.json();
            
            // Hide loading
            loadingIndicator.style.display = 'none';
            summaryOutput.style.display = 'block';
            
            if (data.success) {
                summaryOutput.innerHTML = `<div class="summary-content">${escapeHtml(data.summary).replace(/\n/g, '<br>')}</div>`;
                copyBtn.style.display = 'block';
            } else {
                summaryOutput.innerHTML = `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> ${data.error}</div>`;
            }
        } catch (error) {
            console.error('Error:', error);
            loadingIndicator.style.display = 'none';
            summaryOutput.style.display = 'block';
            summaryOutput.innerHTML = `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> Failed to generate summary. Please try again.</div>`;
        }
    });
    
    // Copy to clipboard
    function copySummary() {
        const summaryText = summaryOutput.querySelector('.summary-content').innerText;
        navigator.clipboard.writeText(summaryText).then(function() {
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="bi bi-check2"></i> Copied!';
            setTimeout(function() {
                copyBtn.innerHTML = originalText;
            }, 2000);
        });
    }
    
    // Escape HTML
    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
{% endblock %}
