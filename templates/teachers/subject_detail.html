{% extends 'teachers/base_teacher.html' %}

{% block title %}{{ subject.name }}{% endblock %}

{% block teacher_content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow-lg">
            <div class="card-header d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div>
                    <h3 class="mb-0"><i class="bi bi-book me-2"></i>{{ subject.name }}</h3>
                    <p class="mb-0 small">{{ subject.description }}</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'upload_pdf' subject.id %}" class="btn btn-light">
                        <i class="bi bi-cloud-upload me-1"></i>Upload Document
                    </a>
                    <button class="btn btn-danger" onclick="confirmDeleteSubject()">
                        <i class="bi bi-trash me-1"></i>Delete Subject
                    </button>
                </div>
            </div>
            <div class="card-body">
                <a href="{% url 'teacher_dashboard' %}" class="btn btn-sm btn-outline-secondary mb-3">
                    <i class="bi bi-arrow-left me-1"></i>Back to Dashboard
                </a>
                
                <h5><i class="bi bi-files me-2"></i>Documents ({{ notes.count }})</h5>
                <hr>
                
                {% if notes %}
                    <div class="row g-3">
                        {% for note in notes %}
                            <div class="col-md-6 col-lg-4">
                                <div class="card h-100 shadow-sm hover-shadow">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <i class="{{ note.get_file_icon }} text-primary" style="font-size: 2.5rem;"></i>
                                            <button class="btn btn-sm btn-outline-danger" 
                                                    data-document-id="{{ note.id }}" 
                                                    data-document-title="{{ note.title }}"
                                                    data-delete-url="{% url 'delete_document' note.id %}"
                                                    onclick="confirmDeleteDocument(this)">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                        <h6 class="card-title">{{ note.title }}</h6>
                                        <p class="card-text small text-muted">
                                            <i class="bi bi-calendar me-1"></i>{{ note.created_at|date:"M d, Y" }}<br>
                                            <i class="bi bi-file-earmark me-1"></i>{{ note.get_file_extension|upper }}
                                        </p>
                                        <a href="{{ note.pdf_file.url }}" target="_blank" class="btn btn-sm btn-primary w-100">
                                            <i class="bi bi-eye me-1"></i>Open Document
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>No documents uploaded yet. Click "Upload Document" to add materials for this subject.
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Delete Subject Modal -->
<div class="modal fade" id="deleteSubjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Delete Subject</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong>{{ subject.name }}</strong>?</p>
                <p class="text-danger mb-0">
                    <i class="bi bi-warning me-1"></i>This will permanently delete:
                </p>
                <ul class="text-danger">
                    <li>All {{ notes.count }} document(s)</li>
                    <li>All quizzes and questions</li>
                    <li>All student progress data</li>
                </ul>
                <p class="text-danger"><strong>This action cannot be undone!</strong></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" action="{% url 'delete_subject' subject.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>Yes, Delete Subject
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Document Modal -->
<div class="modal fade" id="deleteDocumentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>Delete Document</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete <strong id="documentTitle"></strong>?</p>
                <p class="text-danger"><i class="bi bi-warning me-1"></i>This will permanently delete the document and any associated quizzes.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" id="deleteDocumentForm" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">
                        <i class="bi bi-trash me-1"></i>Yes, Delete Document
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .hover-shadow {
        transition: all 0.3s ease;
    }
    .hover-shadow:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important;
    }
</style>

<script>
    function confirmDeleteSubject() {
        const modal = new bootstrap.Modal(document.getElementById('deleteSubjectModal'));
        modal.show();
    }
    
    function confirmDeleteDocument(button) {
        const documentTitle = button.getAttribute('data-document-title');
        const deleteUrl = button.getAttribute('data-delete-url');
        
        document.getElementById('documentTitle').textContent = documentTitle;
        const form = document.getElementById('deleteDocumentForm');
        form.action = deleteUrl;
        
        const modal = new bootstrap.Modal(document.getElementById('deleteDocumentModal'));
        modal.show();
    }
</script>
{% endblock %}
